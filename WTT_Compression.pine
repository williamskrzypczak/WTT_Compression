//@version=5
indicator("WaveRider WTT Compression", "WTT_Compression", overlay=true)

// ============================================================================
// Copyright Â© 2025 Bulldog Ventures Inc. All rights reserved.
//
// WaveRider Trading Technologies
// 
// REVISION HISTORY:
// R1.1 - Alert enhancements and default tuning
//       - Added optional alert notifications for bullish/bearish breakouts
//       - Raised default doji body threshold to 30% and standardized tiny breakout markers
//
// R1.0 - Initial release - Doji breakout triangles
//       - Detects classic doji candles with configurable body threshold
//       - Marks bullish and bearish breakouts with orange/purple triangles
//
// The WTT Compression tool highlights potential breakout momentum that follows
// indecision candles. When a doji appears, the script waits for the next bar to
// close beyond the doji's range and surfaces that breakout direction with
// subtle markers.
// ============================================================================

// ============================================================================
// INPUT PARAMETERS
// ============================================================================

// Detection Settings
dojiBodyPercent = input.float(0.3, "Doji Body Threshold", minval=0.0, maxval=0.5, step=0.01, group="Detection Settings", tooltip="Maximum body-to-range ratio (0.30 = body <= 30% of total range) for a candle to qualify as a doji.")
requireCloseBreak = input.bool(true, "Require Close Breakout", group="Detection Settings", tooltip="When enabled, the breakout candle must close beyond the doji high/low. Disable to react on intrabar breaches.")

// Visual Settings
showMarkers = input.bool(true, "Show Breakout Markers", group="Visual Settings", tooltip="Toggle display of the breakout triangles.")
upColor = input.color(color.new(color.orange, 0), "Uptrend Color", group="Visual Settings", tooltip="Marker color for bullish doji breakouts.")
defaultPurple = color.rgb(128, 0, 255)
downColor = input.color(color.new(defaultPurple, 0), "Downtrend Color", group="Visual Settings", tooltip="Marker color for bearish doji breakouts.")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="Alert Settings", tooltip="Send an alert notification whenever a bullish or bearish doji breakout is detected.")

// ============================================================================
// CALCULATIONS
// ============================================================================

hasValidRange = not na(high) and not na(low) and high != low
trueRange = hasValidRange ? high - low : na
bodySize = not na(close) and not na(open) ? math.abs(close - open) : na

isDoji = hasValidRange and not na(bodySize) and not na(trueRange) and trueRange > 0 and bodySize <= trueRange * dojiBodyPercent

hasPriorBar = bar_index > 0
wasDoji = hasPriorBar and nz(isDoji[1], false)

hasPriorHighLow = hasPriorBar and not na(high[1]) and not na(low[1])
closeBreaksUp = hasPriorHighLow and (requireCloseBreak ? close >= high[1] : high > high[1])
closeBreaksDown = hasPriorHighLow and (requireCloseBreak ? close <= low[1] : low < low[1])

isBullBreakout = wasDoji and closeBreaksUp
isBearBreakout = wasDoji and closeBreaksDown

bullAlertMessage = "WaveRider WTT Compression: Bullish doji breakout on " + syminfo.ticker + " at " + str.tostring(close, format.mintick)
bearAlertMessage = "WaveRider WTT Compression: Bearish doji breakout on " + syminfo.ticker + " at " + str.tostring(close, format.mintick)

// ============================================================================
// VISUAL ELEMENTS
// ============================================================================

plotshape(showMarkers and isBullBreakout, title="Doji Breakout Up", style=shape.triangleup, location=location.belowbar, size=size.tiny, color=upColor)
plotshape(showMarkers and isBearBreakout, title="Doji Breakout Down", style=shape.triangledown, location=location.abovebar, size=size.tiny, color=downColor)

// ============================================================================
// ALERTS
// ============================================================================

if enableAlerts and isBullBreakout
    alert(bullAlertMessage, alert.freq_once_per_bar)

if enableAlerts and isBearBreakout
    alert(bearAlertMessage, alert.freq_once_per_bar)

// ============================================================================
// END OF INDICATOR
// ============================================================================

